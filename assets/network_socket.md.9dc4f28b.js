import{_ as s,c as e,o as a,a as l}from"./app.6c26ea93.js";const D=JSON.parse('{"title":"Socket","description":"","frontmatter":{},"headers":[{"level":2,"title":"Socket","slug":"socket-1","link":"#socket-1","children":[{"level":3,"title":"\u8868\u793A\u65B9\u6CD5","slug":"\u8868\u793A\u65B9\u6CD5","link":"#\u8868\u793A\u65B9\u6CD5","children":[]},{"level":3,"title":"\u8FDE\u63A5","slug":"\u8FDE\u63A5","link":"#\u8FDE\u63A5","children":[]}]},{"level":2,"title":"WebSocket","slug":"websocket","link":"#websocket","children":[{"level":3,"title":"\u4F18\u70B9","slug":"\u4F18\u70B9","link":"#\u4F18\u70B9","children":[]},{"level":3,"title":"\u5EFA\u7ACB\u8FDE\u63A5","slug":"\u5EFA\u7ACB\u8FDE\u63A5","link":"#\u5EFA\u7ACB\u8FDE\u63A5","children":[]},{"level":3,"title":"\u8FDE\u63A5\u4FDD\u6301+\u5FC3\u8DF3","slug":"\u8FDE\u63A5\u4FDD\u6301-\u5FC3\u8DF3","link":"#\u8FDE\u63A5\u4FDD\u6301-\u5FC3\u8DF3","children":[]},{"level":3,"title":"\u54CD\u5E94\u5934/\u8BF7\u6C42\u5934","slug":"\u54CD\u5E94\u5934-\u8BF7\u6C42\u5934","link":"#\u54CD\u5E94\u5934-\u8BF7\u6C42\u5934","children":[]},{"level":3,"title":"\u9047\u5230\u7684\u4E00\u4E9B\u95EE\u9898","slug":"\u9047\u5230\u7684\u4E00\u4E9B\u95EE\u9898","link":"#\u9047\u5230\u7684\u4E00\u4E9B\u95EE\u9898","children":[]}]}],"relativePath":"network/socket.md"}'),n={name:"network/socket.md"},o=l(`<h1 id="socket" tabindex="-1">Socket <a class="header-anchor" href="#socket" aria-hidden="true">#</a></h1><h2 id="socket-1" tabindex="-1">Socket <a class="header-anchor" href="#socket-1" aria-hidden="true">#</a></h2><p>\u5957\u63A5\u5B57(Socket)\uFF0C\u5BF9\u7F51\u7EDC\u4E2D\u4E0D\u540C\u4E3B\u673A\u7684\u5E94\u7528\u8FDB\u7A0B\u4E4B\u95F4\u8FDB\u884C\u53CC\u5411\u901A\u4FE1\u7684\u7AEF\u70B9\u7684\u62BD\u8C61\uFF08\u5E94\u7528\u7A0B\u5E8F\u8BBF\u95EE\u901A\u4FE1\u534F\u8BAE\u7684\u64CD\u4F5C\u7CFB\u7EDF\u8C03\u7528\u5957\u63A5\u5B57\uFF09</p><ul><li>\u5957\u63A5\u5B57\u4E0A\u8054\u5E94\u7528\u8FDB\u7A0B\uFF0C\u4E0B\u8054\u7F51\u7EDC\u534F\u8BAE\u6808</li><li>\u5E94\u7528\u7A0B\u5E8F\u901A\u8FC7\u7F51\u7EDC\u534F\u8BAE\u8FDB\u884C\u901A\u4FE1\u7684\u63A5\u53E3</li><li>\u5E94\u7528\u7A0B\u5E8F\u4E0E\u7F51\u7EDC\u534F\u8BAE\u6808\u8FDB\u884C\u4EA4\u4E92\u7684\u63A5\u53E3</li></ul><h3 id="\u8868\u793A\u65B9\u6CD5" tabindex="-1">\u8868\u793A\u65B9\u6CD5 <a class="header-anchor" href="#\u8868\u793A\u65B9\u6CD5" aria-hidden="true">#</a></h3><p>IP \u5730\u5740:\u7AEF\u53E3\u53F7</p><h3 id="\u8FDE\u63A5" tabindex="-1">\u8FDE\u63A5 <a class="header-anchor" href="#\u8FDE\u63A5" aria-hidden="true">#</a></h3><p>\u4E00\u5BF9\u5957\u63A5\u5B57\uFF1AClient Socket/Servre Socket</p><ul><li>\u670D\u52A1\u5668\u76D1\u542C</li></ul><p>\u670D\u52A1\u5668\u7AEF\u5957\u63A5\u5B57\u5E76\u4E0D\u5B9A\u4F4D\u5177\u4F53\u7684\u5BA2\u6237\u7AEF\u5957\u63A5\u5B57\uFF0C\u5904\u4E8E\u7B49\u5F85\u8FDE\u63A5\u7684\u72B6\u6001\uFF0C\u8BD5\u8BD5\u76D1\u63A7\u7F51\u7EDC\u72B6\u6001</p><ul><li>\u5BA2\u6237\u7AEF\u8BF7\u6C42</li></ul><p>\u5BA2\u6237\u7AEF\u7684\u5957\u63A5\u5B57\u63D0\u51FA\u8FDE\u63A5\u8BF7\u6C42\uFF0C\u8981\u8FDE\u63A5\u7684\u76EE\u6807\u662F\u670D\u52A1\u5668\u7AEF\u7684\u5957\u63A5\u5B57</p><ul><li>\u8FDE\u63A5\u786E\u8BA4</li></ul><p>\u670D\u52A1\u7AEF\u5957\u63A5\u5B57\u63A5\u6536\u5230\u5BA2\u6237\u7AEF\u5957\u63A5\u5B57\u7684\u8FDE\u63A5\u8BF7\u6C42\uFF0C\u54CD\u5E94\u5BA2\u6237\u7AEF\u5957\u63A5\u5B57\u7684\u8BF7\u6C42\uFF0C\u5EFA\u7ACB\u65B0\u7684\u7EBF\u7A0B\uFF0C\u5E76\u628A\u670D\u52A1\u5668\u7AEF\u5957\u63A5\u5B57\u7684\u63CF\u8FF0\u53D1\u9001\u7ED9\u5BA2\u6237\u7AEF\u3002\u5BA2\u6237\u7AEF\u786E\u8BA4\u4E86\u6B64\u63CF\u8FF0\uFF0C\u8FDE\u63A5\u5EFA\u7ACB\uFF0C\u670D\u52A1\u5668\u7AEF\u5957\u63A5\u5B57\u7EE7\u7EED\u5904\u4E8E\u76D1\u542C\u72B6\u6001\uFF0C\u63A5\u6536\u5176\u4ED6\u5BA2\u6237\u7AEF\u5957\u63A5\u5B57\u7684\u8FDE\u63A5\u8BF7\u6C42</p><h2 id="websocket" tabindex="-1">WebSocket <a class="header-anchor" href="#websocket" aria-hidden="true">#</a></h2><p>\u6D4F\u89C8\u5668\u4E2D\u7528\u4E8E\u53CC\u5411\u901A\u4FE1\u7684\u4E00\u79CD TCP \u4F20\u8F93\u534F\u8BAE\uFF0C\u5E76\u590D\u7528 HTTP \u7684\u63E1\u624B\u901A\u9053</p><h3 id="\u4F18\u70B9" tabindex="-1">\u4F18\u70B9 <a class="header-anchor" href="#\u4F18\u70B9" aria-hidden="true">#</a></h3><ul><li>\u652F\u6301\u53CC\u5411\u901A\u4FE1\uFF0C\u5B9E\u65F6\u6027\u66F4\u5F3A</li><li>\u66F4\u597D\u7684\u4E8C\u8FDB\u5236\u652F\u6301</li><li>\u8F83\u5C11\u7684\u63A7\u5236\u5F00\u9500\uFF08\u6570\u636E\u5305+4 \u5B57\u8282\u7684\u63A9\u7801\uFF0C\u800C HTTP \u6BCF\u6B21\u8BF7\u6C42\u90FD\u8981\u643A\u5E26\u5B8C\u6574\u7684\u5934\u90E8\uFF09</li><li>\u652F\u6301\u6269\u5C55\uFF08WS \u534F\u8BAE\u5B9A\u4E49\u4E86\u6269\u5C55\uFF0C\u81EA\u5B9A\u4E49\u6269\u5C55\u534F\u8BAE\u3001\u81EA\u534F\u8BAE\uFF09\u81EA\u5B9A\u4E49\u538B\u7F29\u7B97\u6CD5</li></ul><h3 id="\u5EFA\u7ACB\u8FDE\u63A5" tabindex="-1">\u5EFA\u7ACB\u8FDE\u63A5 <a class="header-anchor" href="#\u5EFA\u7ACB\u8FDE\u63A5" aria-hidden="true">#</a></h3><blockquote><p>\u5BA2\u6237\u7AEF\uFF1A\u7533\u8BF7\u534F\u8BAE\u5347\u7EA7</p></blockquote><div class="language-txt"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki"><code><span class="line"><span style="color:#A6ACCD;">GET / HTTP/1.1</span></span>
<span class="line"><span style="color:#A6ACCD;">Host: localhost:8080</span></span>
<span class="line"><span style="color:#A6ACCD;">Origin: http://127.0.0.1:3000</span></span>
<span class="line"><span style="color:#A6ACCD;">Connection: Upgrade</span></span>
<span class="line"><span style="color:#A6ACCD;">Upgrade: websocket</span></span>
<span class="line"><span style="color:#A6ACCD;">Sec-WebSocket-Version: 13</span></span>
<span class="line"><span style="color:#A6ACCD;">Sec-WebSocket-Key: w4v7O6xFTi36lq3RNcgctw==</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><blockquote><p>\u670D\u52A1\u7AEF\uFF1A\u54CD\u5E94\u534F\u8BAE\u5347\u7EA7</p></blockquote><p>\u72B6\u6001\u4EE3\u7801 101 \u8868\u793A\u534F\u8BAE\u5207\u6362</p><div class="language-txt"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki"><code><span class="line"><span style="color:#A6ACCD;">HTTP/1.1 101 Switching Protocols</span></span>
<span class="line"><span style="color:#A6ACCD;">Connection:Upgrade</span></span>
<span class="line"><span style="color:#A6ACCD;">Upgrade: websocket</span></span>
<span class="line"><span style="color:#A6ACCD;">Sec-WebSocket-Accept: Oy4NRAQ13jhfONC7bP8dTKb4PTU=</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><h3 id="\u8FDE\u63A5\u4FDD\u6301-\u5FC3\u8DF3" tabindex="-1">\u8FDE\u63A5\u4FDD\u6301+\u5FC3\u8DF3 <a class="header-anchor" href="#\u8FDE\u63A5\u4FDD\u6301-\u5FC3\u8DF3" aria-hidden="true">#</a></h3><p>\u957F\u65F6\u95F4\u6CA1\u6709\u6570\u636E\u5F80\u6765\u7684\u8FDE\u63A5\uFF0C\u957F\u65F6\u95F4\u4FDD\u6301\u4F1A\u6D6A\u8D39\u8FDE\u63A5\u8D44\u6E90\uFF08\u91C7\u7528\u5FC3\u8DF3\u5B9E\u73B0\uFF09</p><ul><li>\u53D1\u9001\u65B9 -&gt; \u63A5\u6536\u65B9 ping</li><li>\u63A5\u6536\u65B9 -&gt; \u53D1\u9001\u65B9 pong</li></ul><h3 id="\u54CD\u5E94\u5934-\u8BF7\u6C42\u5934" tabindex="-1">\u54CD\u5E94\u5934/\u8BF7\u6C42\u5934 <a class="header-anchor" href="#\u54CD\u5E94\u5934-\u8BF7\u6C42\u5934" aria-hidden="true">#</a></h3><h4 id="sec-websocket-key-sec-websocket-accept" tabindex="-1">Sec-WebSocket-Key/Sec-Websocket-Accept <a class="header-anchor" href="#sec-websocket-key-sec-websocket-accept" aria-hidden="true">#</a></h4><ul><li>\u907F\u514D\u670D\u52A1\u7AEF\u6536\u5230\u975E\u6CD5\u7684 websocket \u8FDE\u63A5</li><li>\u786E\u4FDD\u670D\u52A1\u7AEF\u7406\u89E3 WebSocket \u8FDE\u63A5</li><li>\u8BF7\u6C42\u8BBE\u7F6E header \u65F6\u662F\u88AB\u7981\u6B62\u7684</li><li>\u5BF9\u4E8E\u53CD\u5411\u4EE3\u7406\u670D\u52A1\u5668\u6765\u8BF4\uFF0C\u53EF\u4EE5\u7406\u89E3 WebSocket \u63E1\u624B\u4E0D\u4F1A\u4EA7\u751F\u65E0\u7528\u7684\u7F13\u5B58</li></ul><h3 id="\u9047\u5230\u7684\u4E00\u4E9B\u95EE\u9898" tabindex="-1">\u9047\u5230\u7684\u4E00\u4E9B\u95EE\u9898 <a class="header-anchor" href="#\u9047\u5230\u7684\u4E00\u4E9B\u95EE\u9898" aria-hidden="true">#</a></h3><blockquote><p>\u5982\u4F55\u8BA1\u7B97\u54CD\u5E94\u5934\u4E2D Sec-Websocket-Accept \u7684\u503C</p></blockquote><p>\u670D\u52A1\u5668\u83B7\u53D6\u63E1\u624B\u8BF7\u6C42\u4E2D\u7684 Sec-WebSocket-Key \u7684\u503C\uFF0C\u7136\u540E\u9644\u52A0 GUID(Globally Unique Identifier 258EAFA5-E914-47DA-95CA-C5AB0DC85B11)\uFF0C\u91C7\u7528\u65B0\u7684 SHA-1 \u503C\uFF0C\u8FDB\u884C base64 \u7F16\u7801</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> createHash </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">crypto</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> key </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> req</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">headers[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">sec-websocket-key</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">]</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">tirm</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;">// \u8FD9\u91CC\u7ED3\u679C\u5C31\u662F Sec-Websocket-Accept \u54CD\u5E94\u503C</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> digest </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">createHash</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">sha1</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">update</span><span style="color:#A6ACCD;">(key </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> GUID)</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">digest</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">base64</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div>`,34),p=[o];function c(t,r,i,d,A,h){return a(),e("div",null,p)}const y=s(n,[["render",c]]);export{D as __pageData,y as default};
