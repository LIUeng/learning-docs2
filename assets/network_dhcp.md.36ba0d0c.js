import{_ as s,o as a,c as n,Q as l}from"./chunks/framework.0e8ae64e.js";const C=JSON.parse('{"title":"DHCP","description":"","frontmatter":{},"headers":[],"relativePath":"network/dhcp.md","filePath":"network/dhcp.md","lastUpdated":1670330848000}'),p={name:"network/dhcp.md"},o=l(`<h1 id="dhcp" tabindex="-1">DHCP <a class="header-anchor" href="#dhcp" aria-label="Permalink to &quot;DHCP&quot;">​</a></h1><p>动态主机配置协议（DHCP) - dynamic host configuration protocol</p><h2 id="如何配置-ip-地址" tabindex="-1">如何配置 IP 地址 <a class="header-anchor" href="#如何配置-ip-地址" aria-label="Permalink to &quot;如何配置 IP 地址&quot;">​</a></h2><blockquote><p>手动配置</p></blockquote><ul><li>net-tools</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">sudo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ifconfig</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">eth1</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">10.0</span><span style="color:#9ECBFF;">.0.1/24</span></span>
<span class="line"><span style="color:#B392F0;">sudo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ifconfig</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">eth1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">up</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ifconfig</span><span style="color:#24292E;"> </span><span style="color:#032F62;">eth1</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">10.0</span><span style="color:#032F62;">.0.1/24</span></span>
<span class="line"><span style="color:#6F42C1;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ifconfig</span><span style="color:#24292E;"> </span><span style="color:#032F62;">eth1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">up</span></span></code></pre></div><ul><li>iproute2</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">sudo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ip</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">addr</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">add</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">10.0</span><span style="color:#9ECBFF;">.0.1/24</span></span>
<span class="line"><span style="color:#B392F0;">sudo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ip</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">link</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">set</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">up</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">eth1</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ip</span><span style="color:#24292E;"> </span><span style="color:#032F62;">addr</span><span style="color:#24292E;"> </span><span style="color:#032F62;">add</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">10.0</span><span style="color:#032F62;">.0.1/24</span></span>
<span class="line"><span style="color:#6F42C1;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ip</span><span style="color:#24292E;"> </span><span style="color:#032F62;">link</span><span style="color:#24292E;"> </span><span style="color:#032F62;">set</span><span style="color:#24292E;"> </span><span style="color:#032F62;">up</span><span style="color:#24292E;"> </span><span style="color:#032F62;">eth1</span></span></code></pre></div><blockquote><p>配置文件</p></blockquote><p><code>CIDR 子网掩码 广播地址 网关地址</code></p><h2 id="动态主机配置协议-dhcp" tabindex="-1">动态主机配置协议（DHCP) <a class="header-anchor" href="#动态主机配置协议-dhcp" aria-label="Permalink to &quot;动态主机配置协议（DHCP)&quot;">​</a></h2><p>形象举例：租房 -&gt; 退租</p><blockquote><p>广播包分配一个地址</p></blockquote><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>MAC 头</td><td>广播 MAC(ff:ff:ff:ff:ff:ff)</td></tr><tr><td>IP 头</td><td>广播 IP 255.255.255.255</td></tr><tr><td>UDP 头</td><td>源端口： 68 <br> 目标端口 67</td></tr><tr><td>BOOTP</td><td>BOOT request</td></tr><tr><td></td><td>我的 MAC 是这个，我还没有 IP</td></tr></tbody></table><p>:::warn BOOTP 广播包封装了 UDP，UDP 封装了 BOOTP，DHCP 是 BOOTP 的增强版 :::</p><blockquote><p>DHCP offer</p></blockquote><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>MAC 头</td><td>广播 MAC(ff:ff:ff:ff:ff:ff)</td></tr><tr><td>IP 头</td><td>DHCP SERVER 的 IP：0.0.0.0 <br> 广播 IP 255.255.255.255</td></tr><tr><td>UDP 头</td><td>源端口： 68 <br> 目标端口 67</td></tr><tr><td>BOOTP</td><td>BOOT reply</td></tr><tr><td></td><td>这是你的 MAC，我分配了这个 IP，租给你</td></tr></tbody></table><blockquote><p>DHCP request</p></blockquote><p>确认是否租用(接收 DHCP offer)</p><blockquote><p>ACK</p></blockquote><p>当 DHCP Server 接收到客户机的 DHCP request 之后，广播返回给客户机一个 DHCP ACK 消息包，表明已经接受客户机的选择，并将 IP 地址的合法租用信息和其他配置的信息放入广播包</p><blockquote><p>IP 地址的收回和续租</p></blockquote><p>DHCP request &lt;-&gt; DHCP ACK 更新配置</p><h2 id="pxe" tabindex="-1">PXE <a class="header-anchor" href="#pxe" aria-label="Permalink to &quot;PXE&quot;">​</a></h2><p>预启动执行环境 Pre-boot Execution Environment</p><div class="tip custom-block"><p class="custom-block-title">PXE</p><p>PXE 协议氛围客户端服务器端 <br> 客户端在 BIOS, 启动 BIOS 把 PXE 客户端调入内存，可以连接服务端</p></div><ul><li>系统</li></ul><p>MBR 启动 GRUB -&gt; GRUB 加载内核、加载作为根文件系统的 initramfs 文件 -&gt; 内核启动</p><h3 id="原理" tabindex="-1">原理 <a class="header-anchor" href="#原理" aria-label="Permalink to &quot;原理&quot;">​</a></h3><ul><li>PXE 客户端需要有个 IP 地址</li><li>DHCP request</li><li>DHCP server ACK</li><li>配置文件</li></ul><p>DHCP Server 配置(IP 地址段 子网掩码 网关地址 租期)</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">ddns-update-style</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">interim</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#B392F0;">ignore</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">client-updates</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#B392F0;">allow</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">booting</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#B392F0;">allow</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">bootp</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#B392F0;">subnet</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">192.168</span><span style="color:#9ECBFF;">.1.0</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">netmask</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">255.255</span><span style="color:#9ECBFF;">.255.0</span></span>
<span class="line"><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#B392F0;">option</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">routers</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">192.168</span><span style="color:#9ECBFF;">.1.1</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#B392F0;">option</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">subnet-mask</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">255.255</span><span style="color:#9ECBFF;">.255.0</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#B392F0;">option</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">time-offset</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-18000</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#B392F0;">default-lease-time</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">21600</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#B392F0;">max-lease-time</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">43200</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#B392F0;">range</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">dynamic-bootp</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">192.168</span><span style="color:#9ECBFF;">.1.240</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">192.168</span><span style="color:#9ECBFF;">.1.250</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#B392F0;">filename</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;pxelinux.0&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#B392F0;">next-server</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">192.168</span><span style="color:#9ECBFF;">.1.180</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">ddns-update-style</span><span style="color:#24292E;"> </span><span style="color:#032F62;">interim</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#6F42C1;">ignore</span><span style="color:#24292E;"> </span><span style="color:#032F62;">client-updates</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#6F42C1;">allow</span><span style="color:#24292E;"> </span><span style="color:#032F62;">booting</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#6F42C1;">allow</span><span style="color:#24292E;"> </span><span style="color:#032F62;">bootp</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#6F42C1;">subnet</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">192.168</span><span style="color:#032F62;">.1.0</span><span style="color:#24292E;"> </span><span style="color:#032F62;">netmask</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">255.255</span><span style="color:#032F62;">.255.0</span></span>
<span class="line"><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#6F42C1;">option</span><span style="color:#24292E;"> </span><span style="color:#032F62;">routers</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">192.168</span><span style="color:#032F62;">.1.1</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#6F42C1;">option</span><span style="color:#24292E;"> </span><span style="color:#032F62;">subnet-mask</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">255.255</span><span style="color:#032F62;">.255.0</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#6F42C1;">option</span><span style="color:#24292E;"> </span><span style="color:#032F62;">time-offset</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-18000</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#6F42C1;">default-lease-time</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">21600</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#6F42C1;">max-lease-time</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">43200</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#6F42C1;">range</span><span style="color:#24292E;"> </span><span style="color:#032F62;">dynamic-bootp</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">192.168</span><span style="color:#032F62;">.1.240</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">192.168</span><span style="color:#032F62;">.1.250</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#6F42C1;">filename</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;pxelinux.0&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#6F42C1;">next-server</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">192.168</span><span style="color:#032F62;">.1.180</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><ul><li>next-server</li></ul><p>要使用 PXE，需要配置 next-server，指向 PXE 服务器的地址，另外要配置初始启动文件 filename</p><h3 id="pxe-工作过程" tabindex="-1">PXE 工作过程 <a class="header-anchor" href="#pxe-工作过程" aria-label="Permalink to &quot;PXE 工作过程&quot;">​</a></h3><ol><li>启动 PXE 客户端</li><li>DHCP Server 分配一个 IP 地址、PXE 服务器的地址、启动文件 pxelinus.0</li><li>PXE 客户端向 TFTP 服务器请求下载文件</li><li>下载完毕，执行文件（文件会指向 PXE 客户端，向 TFTP 服务器请求计算机的配置信息 pxelinux.cfg），TFTP 服务器会给 PXE 客户端一个配置文件包括内核、initramfs，PXE 客户端会请求这些文件</li><li>启动 Linux 内核</li></ol>`,36),t=[o];function e(c,r,E,y,i,d){return a(),n("div",null,t)}const u=s(p,[["render",e]]);export{C as __pageData,u as default};
